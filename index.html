<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Buckeye Hunter Hub – Leaflet + Draw + Save</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet (unpkg) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Leaflet.draw (unpkg) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100vh; }

    .toolbar {
      position: fixed; z-index: 1000; top: 10px; left: 10px;
      background: #ffffff; border-radius: 10px; box-shadow: 0 4px 16px rgba(0,0,0,.15);
      padding: 8px 10px; font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      display: flex; gap: 8px; align-items: center;
    }
    .toolbar button, .toolbar label {
      cursor: pointer; border: 1px solid #ddd; border-radius: 8px; padding: 6px 10px; background: #f9f9f9;
    }
    .toolbar button:hover, .toolbar label:hover { background: #f1f1f1; }
    .toolbar input[type="file"] { display: none; }

    .notice {
      position: fixed; bottom: 8px; left: 8px; font: 12px system-ui;
      background: rgba(255,255,255,.85); padding: 4px 6px; border-radius: 6px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Simple UI -->
  <div class="toolbar">
    <button id="btnExport" title="Download your drawings as GeoJSON">Export GeoJSON</button>
    <button id="btnClear" title="Clear all drawings from the map">Clear</button>
    <label for="fileImport" title="Import a GeoJSON file you exported earlier">Import GeoJSON</label>
    <input type="file" id="fileImport" accept=".json,.geojson,application/geo+json,application/json"/>
    <button id="btnFull" title="Toggle fullscreen">Fullscreen</button>
  </div>

  <div class="notice">
    Tiles © <a href="https://www.openstreetmap.org/" target="_blank" rel="noreferrer">OpenStreetMap</a> contributors
  </div>

  <script>
    // --- Base map (Ohio) ---
    const map = L.map('map').setView([40.4173, -82.9071], 6);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // --- Drawing layer & controls ---
    const drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    const drawControl = new L.Control.Draw({
      position: 'topleft',
      draw: {
        marker: true,
        polyline: { shapeOptions: { color: '#2b6cb0', weight: 4 } },
        polygon: { allowIntersection: false, showArea: true, shapeOptions: { color: '#2f855a' } },
        rectangle: { shapeOptions: { color: '#d69e2e' } },
        circle: false
      },
      edit: { featureGroup: drawnItems, remove: true }
    });
    map.addControl(drawControl);

    // --- Persistence (auto-save to localStorage) ---
    const STORAGE_KEY = 'bhh_leaflet_drawings_v1';

    function saveAll() {
      const geo = drawnItems.toGeoJSON();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(geo));
    }

    function restoreAll() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const geo = JSON.parse(raw);
        L.geoJSON(geo, { onEachFeature: (_, layer) => drawnItems.addLayer(layer) });
      } catch (e) {
        console.warn('Restore failed:', e);
      }
    }

    restoreAll();

    // Save after create/edit/delete
    map.on(L.Draw.Event.CREATED, e => { drawnItems.addLayer(e.layer); saveAll(); });
    map.on(L.Draw.Event.EDITED, saveAll);
    map.on(L.Draw.Event.DELETED, saveAll);

    // --- Export / Import / Clear / Fullscreen ---
    document.getElementById('btnExport').addEventListener('click', () => {
      const data = drawnItems.toGeoJSON();
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/geo+json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'buckeyehunterhub-drawings.geojson';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    document.getElementById('btnClear').addEventListener('click', () => {
      drawnItems.clearLayers();
      saveAll();
    });

    document.getElementById('fileImport').addEventListener('change', (ev) => {
      const file = ev.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const geo = JSON.parse(reader.result);
          L.geoJSON(geo, { onEachFeature: (_, layer) => drawnItems.addLayer(layer) });
          saveAll();
        } catch (e) { alert('Invalid GeoJSON file.'); }
      };
      reader.readAsText(file);
      ev.target.value = '';
    });

    const mapEl = document.getElementById('map');
    document.getElementById('btnFull').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        mapEl.requestFullscreen?.() || mapEl.webkitRequestFullscreen?.();
      } else {
        document.exitFullscreen?.() || document.webkitExitFullscreen?.();
      }
    });

    // Optional: a sample marker you can delete
    // L.marker([40.4, -82.9]).addTo(map).bindPopup('Sample Hunting Spot');
  </script>
</body>
</html>

  </script>
</body>
</html>
